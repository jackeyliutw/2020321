<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" crossorigin="anonymous" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk="></script>
</head>
<body>
<div style="margin-left: 10px;margin-top:2%">
    <h3 style="font-weight:bold">這是一個使用文字紀錄的Web3</h3>

    <h4>輸入文字：</h4>
    <h4><input name="欄位名稱" id="word" type="text"><br></h4>
    <h4>輸入暱稱：</h4>
    <h4><input name="欄位名稱" id="Name" type="text"><br>
    <button class="btn btn-default" style="margin-top:2%" onclick="getMoney()" type="submit">輸入</button>
    <br>
    

    <br>
    <br>
    <a style="size:15px;color:#3B0D11;font-weight:bold">文字上限一萬字元</a>
</h4></div>
<script>

    if (typeof web3 !== 'undefined') {

      web3 = new Web3(web3.currentProvider);

    } else {

      // 確認是否使用metamask地址

      web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));

    }
    var myContract;

    var coinbase;



    async function foso() {

      coinbase = await web3.eth.getCoinbase();

      var contract_address = "0xb2CD1185B0ad018c305a932da70405C50aE9d4cB";//合約位置

      var contract_abi = [{"constant":true,"inputs":[],"name":"count","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"ArticleWriter","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"writers","outputs":[{"name":"owner","type":"address"},{"name":"text","type":"string"},{"name":"name","type":"string"},{"name":"number","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"text","type":"string"},{"name":"name","type":"string"}],"name":"RecordText","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"owner","type":"address"}],"name":"getArticleByOwner","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"ArticleContent","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"text","type":"string"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"Number","type":"uint256"}],"name":"Record","type":"event"}];





      myContract = new web3.eth.Contract(contract_abi, contract_address);



    }

    foso();





    async function getMoney() {



      var ID = document.getElementById("word").value;

      var NM = document.getElementById("Name").value;

      myContract.methods.RecordText(ID, NM).send({ from: coinbase }).then(function (receipt) {


        alert("交易成功，紀錄文字");

      });
      
      

    }
</script>
</body>
</html>

<!-- 合約網址 https://rinkeby.etherscan.io/address/0xb2cd1185b0ad018c305a932da70405c50ae9d4cb#code -->

<!-- 合約  /**
*Submitted for verification at Etherscan.io on 2019-12-04
*/

pragma solidity ^0.4.24;
//合約撰寫者 顏培祐
contract RecordTextForever {
   uint public count = 0;
   
   event Record(address owner,string text, string name,uint Number);
   
   mapping (uint => address) public ArticleWriter;//撰寫者Address
   mapping (uint => string)  public ArticleContent;//文章編號對應內容
   mapping (address => uint) writerArticles;//撰寫者對應編號
   
   uint ContText = 0;//內容編號
   
   struct Writer{
       address owner;
       string text;
       string name;
       uint number;
   }
   Writer[] public writers;
  
   
   
   uint D = writers.push(Writer(msg.sender,'Test','ContractOwner',ContText));//此行沒用純此行沒用純測試測試
   
   function RecordText(string text,string name) public {//紀錄文address 文章內容 用戶名稱 文章編號
       ContText++;
       ArticleWriter[ContText] = msg.sender; 
       ArticleContent[ContText] = text;
       writerArticles[msg.sender] = ContText;
       
       emit Record(msg.sender,text,name,ContText);//紀錄
       
       uint D = writers.push(Writer(msg.sender,text,name,ContText));
       
       
       count++;
       
   }
   
   
   function getArticleByOwner(address owner) external view returns (uint[]){ //透過輸入 Address 輸入回傳文章 流水號
       uint[] memory result = new uint[](writerArticles[owner]);
       uint counter = 0;
       
       for(uint i=1;i<=writers.length;i++){
           if(ArticleWriter[i] == owner){
               result[counter] = i;
                counter++;
           }
       }
       return result;
   } 
   
   
  
   
   
} -->
